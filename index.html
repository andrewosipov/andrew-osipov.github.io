<!doctype html>
<head>
    <link href="https://contentful.github.io/ui-extensions-sdk/cf-extension.css" rel="stylesheet">
    <script src="https://unpkg.com/contentful-ui-extensions-sdk@3"></script>

    <script src="tinymce/tinymce.min.js"></script>

    <style type="text/css">
        .tox-dialog {
            /* The advcode dialog was too tall and being clipped */
            max-height: calc(100% - 5px) !important;
        }
        body {
            border: 1px;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        div#editor {
            width:100%;
            min-height:350px;
            max-height: 500px;
        }
    </style>
</head>
<body>
<div id="editor"></div>
<script>
    window.contentfulExtension.init(function (ext) {
        var currentValue
        ext.window.startAutoResizer()
        const editor = tinymce.init({
            selector: '#editor',
            plugins: "autoresize textpattern lists advlist a11ychecker linkchecker media mediaembed tinymcespellchecker advcode",
            toolbar: "undo redo | formatselect | bold italic | alignleft aligncenter alignright alignjustify | numlist bullist outdent indent | code",
            menubar: "edit view insert format",
            link_class_list: [
                {title: 'None', value: ''},
                {title: 'Button', value: 'button'},
                {title: 'Big button', value: 'button-big'}
            ],
        });

        editor.setData(ext.field.getValue())
        ext.field.onValueChanged(function(value) {
            if (value !== currentValue) {
                currentValue = value
                editor.setData(value)
            }
        })
        editor.on('change', function() {
            const value = editor.getData()
            if (currentValue !== value) {
                currentValue = value
                ext.field.setValue(value)
            }
        })
    })
</script>
</body>
